<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="index.css">
</head>

<body>
    <h1 class="titulo">Teste de Sessão com Node.js</h1>
    <div class="container">
    <div id="loginDiv">
        <h2>Login</h2>
        <input type="text" id="username" placeholder="Usuário"> <br>
        <input type="password" id="password" placeholder="Senha"> <br>
        <button onclick="login()">Entrar</button>
        <p id="loginMsg"></p>
    </div>

    <div id="perfilDiv" style="display:none;">
        <h2>Perfil</h2>
        <p id="perfilMsg"></p>
        <button class="buttonSubmit" onclick="logout()">Logout</button>
    </div>

    </div>
    <script>
        const baseURL = 'http://localhost:3000';

        async function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            const res = await fetch(`${baseURL}/login`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password }),
                credentials: 'include'
            });

            const text = await res.text();
            document.getElementById('loginMsg').innerText = text;

            if (text.includes('bem-sucedido')) {
                document.getElementById('loginDiv').style.display = 'none';
                document.getElementById('perfilDiv').style.display = 'block';
                getPerfil();
            }
        }

        async function getPerfil() {
            const res = await fetch(`${baseURL}/perfil`, {
                method: 'GET',
                credentials: 'include'
            });

            const text = await res.text();
            document.getElementById('perfilMsg').innerText = text;
        }

        async function logout() {
            const res = await fetch(`${baseURL}/logout`, {
                method: 'GET',
                credentials: 'include'
            });

            const text = await res.text();
            alert(text);
            document.getElementById('perfilDiv').style.display = 'none';
            document.getElementById('loginDiv').style.display = 'block';
            document.getElementById('loginMsg').innerText = '';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }
    </script>
</body>

</html>